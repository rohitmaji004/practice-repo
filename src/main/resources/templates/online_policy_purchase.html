<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Policy Purchase</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 28rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Main Container -->
    <div class="container bg-white shadow-xl rounded-2xl overflow-hidden">

        <!-- Header -->
        <div class="p-6 bg-blue-600 text-white text-center">
            <h1 class="text-3xl font-bold tracking-tight">Purchase Your Policy</h1>
            <p class="text-blue-200 mt-1">Quick and easy online insurance.</p>
        </div>

        <div class="p-6 md:p-8">
            <!-- First step form: Policy & Vehicle Details -->
            <div id="step1-container">
                <form id="purchaseForm" class="space-y-6">
                    <div>
                        <label for="policyId" class="block text-sm font-medium text-gray-700">Policy ID</label>
                        <div class="mt-1">
                            <input id="policyId" name="policyId" type="number" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2.5 transition duration-150 ease-in-out">
                        </div>
                    </div>
                    <div>
                        <label for="vehicleId" class="block text-sm font-medium text-gray-700">Vehicle ID</label>
                        <div class="mt-1">
                            <input id="vehicleId" name="vehicleId" type="number" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2.5 transition duration-150 ease-in-out">
                        </div>
                    </div>
                    <div>
                        <label for="paymentMethod" class="block text-sm font-medium text-gray-700">Payment Method</label>
                        <div class="mt-1">
                            <select id="paymentMethod" name="paymentMethod" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2.5 transition duration-150 ease-in-out">
                                <option value="">Select a method</option>
                                <option value="CREDIT_CARD">Credit Card</option>
                                <option value="DEBIT_CARD">Debit Card</option>
                                <option value="UPI">UPI</option>
                                <option value="NET_BANKING">Net Banking</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                            Proceed to Payment
                        </button>
                    </div>
                </form>
            </div>

            <!-- Second step form: Payment Details -->
            <div id="step2-container" class="hidden">
                <h2 class="text-2xl font-bold tracking-tight text-gray-800 mb-6 text-center">Enter Payment Details</h2>
                <div id="payment-form-container"></div>
                <div id="payment-details-form" class="space-y-6">
                    <!-- Dynamic content will be injected here -->
                </div>
            </div>

            <!-- Result Display Area -->
            <div id="result" class="mt-6 p-4 rounded-lg text-center transition-all duration-300 ease-in-out opacity-0"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const step1Container = document.getElementById('step1-container');
            const step2Container = document.getElementById('step2-container');
            const purchaseForm = document.getElementById('purchaseForm');
            const paymentFormContainer = document.getElementById('payment-form-container');
            const resultDiv = document.getElementById('result');

            let purchasePayload = {};

            purchaseForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const policyId = document.getElementById('policyId').value;
                const vehicleId = document.getElementById('vehicleId').value;
                const paymentMethod = document.getElementById('paymentMethod').value;

                if (!policyId || !vehicleId || !paymentMethod) {
                    showResult('Please fill in all fields.', 'error');
                    return;
                }

                purchasePayload = {
                    policyId: parseInt(policyId, 10),
                    vehicleId: parseInt(vehicleId, 10),
                    paymentMethod: paymentMethod
                };

                // Hide step 1 and show step 2
                step1Container.classList.add('hidden');
                step2Container.classList.remove('hidden');

                // Dynamically generate the payment form based on method
                renderPaymentForm(paymentMethod);
            });

            function renderPaymentForm(method) {
                let formHtml = '';
                let buttonText = '';

                switch (method) {
                    case 'CREDIT_CARD':
                    case 'DEBIT_CARD':
                        formHtml = `
                            <div class="space-y-4">
                                <div>
                                    <label for="cardNumber" class="block text-sm font-medium text-gray-700">Card Number</label>
                                    <input type="text" id="cardNumber" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5">
                                </div>
                                <div>
                                    <label for="cardExpiry" class="block text-sm font-medium text-gray-700">Expiry (MM/YY)</label>
                                    <input type="text" id="cardExpiry" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5">
                                </div>
                                <div>
                                    <label for="cardCVC" class="block text-sm font-medium text-gray-700">CVC</label>
                                    <input type="text" id="cardCVC" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5">
                                </div>
                            </div>
                        `;
                        buttonText = `Pay with ${method.replace('_', ' ')}`;
                        break;
                    case 'UPI':
                        formHtml = `
                            <div>
                                <label for="upiId" class="block text-sm font-medium text-gray-700">UPI ID</label>
                                <input type="text" id="upiId" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5">
                            </div>
                        `;
                        buttonText = 'Pay with UPI';
                        break;
                    case 'NET_BANKING':
                        formHtml = `
                            <div>
                                <label for="bankName" class="block text-sm font-medium text-gray-700">Bank Name</label>
                                <input type="text" id="bankName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5">
                            </div>
                        `;
                        buttonText = 'Pay with Net Banking';
                        break;
                }

                const finalFormHtml = `
                    <form id="payment-details-form" class="space-y-6">
                        ${formHtml}
                        <div>
                            <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out">
                                ${buttonText}
                            </button>
                        </div>
                        <div>
                            <button type="button" id="backButton" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-blue-600 bg-gray-200 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                                &larr; Back
                            </button>
                        </div>
                    </form>
                `;

                paymentFormContainer.innerHTML = finalFormHtml;

                // Add event listeners to the dynamically created elements
                document.getElementById('backButton').addEventListener('click', () => {
                    step2Container.classList.add('hidden');
                    step1Container.classList.remove('hidden');
                    resultDiv.classList.add('opacity-0');
                });
                
                document.getElementById('payment-details-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showResult('Processing your payment...', 'info');
                    try {
                        const response = await simulateApiCall(purchasePayload);
                        if (response.status === 201) {
                            showResult(`Payment successful! Your new policy number is: <span class="font-bold">${response.data.policyNumber}</span>`, 'success');
                        } else {
                            showResult(response.error || 'An unexpected error occurred.', 'error');
                        }
                    } catch (error) {
                        showResult(error.message || 'Failed to connect to the server.', 'error');
                    }
                });
            }

            function showResult(message, type) {
                resultDiv.innerHTML = `<p>${message}</p>`;
                resultDiv.className = 'mt-6 p-4 rounded-lg text-center opacity-100 transition-all duration-300 ease-in-out';
                
                if (type === 'success') {
                    resultDiv.classList.add('bg-green-100', 'text-green-800', 'border-green-300', 'border-2');
                } else if (type === 'error') {
                    resultDiv.classList.add('bg-red-100', 'text-red-800', 'border-red-300', 'border-2');
                } else { // info
                    resultDiv.classList.add('bg-blue-100', 'text-blue-800', 'border-blue-300', 'border-2');
                }
            }

            // Mock function to simulate a fetch call to your backend
            async function simulateApiCall(payload) {
                console.log("Simulating API call with payload:", payload);
                // Simulate network latency
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        // Check for specific values to simulate success or failure
                        if (payload.policyId < 1 || payload.vehicleId < 1) {
                             resolve({ status: 400, error: 'Policy ID and Vehicle ID must be positive numbers.' });
                        } else if (payload.paymentMethod === 'NET_BANKING' && payload.policyId === 123) {
                             // Simulate a failed transaction
                            resolve({ status: 400, error: 'Payment failed for this policy via Net Banking.' });
                        } else {
                            // Simulate a successful API response
                            const mockPolicyNumber = 'INS-' + Math.random().toString(36).substring(2, 10).toUpperCase();
                            resolve({
                                status: 201,
                                data: {
                                    id: 1,
                                    policyNumber: mockPolicyNumber,
                                    userId: payload.userId,
                                    policyId: payload.policyId,
                                    vehicleId: payload.vehicleId,
                                    purchaseDate: new Date().toISOString().split('T')[0],
                                    paymentMethod: payload.paymentMethod,
                                    paymentStatus: "SUCCESSFUL"
                                }
                            });
                        }
                    }, 1500);
                });
            }
        });
    </script>
</body>
</html>
